<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">

    
      <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-PNFDVBB');</script>
      <!-- End Google Tag Manager -->
    

    <!-- Basic -->
    <title>Lambda | Apollo Server</title>
    <meta name="description" content="Setting up Apollo Server with AWS Lambda">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <link rel="shortcut icon" type="image/png" href="../images/favicon-apollo.png" sizes="16x16 32x32 64x64">
    

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.apollographql.com/docs/apollo-server">
    <meta property="og:title" content="Lambda | Apollo Server">
    <meta property="og:description" content="Setting up Apollo Server with AWS Lambda">
    <meta property="og:image" content="">
    <meta name="twitter:site" content="@apollographql">
    <meta name="twitter:title" content="Lambda | Apollo Server">
    <meta name="twitter:description" content="Setting up Apollo Server with AWS Lambda">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="">

    
    
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/themes/prism.min.css" rel="stylesheet" type="text/css">
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" type="text/css">
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-highlight/prism-line-highlight.css" rel="stylesheet" type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic" rel="stylesheet" type="text/css">
    
      <link rel="stylesheet" href="../style/bundle-apollo.css">
    
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
  </head>
  <body class="">
    
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PNFDVBB" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    
      

  <div class="nav sunset">
    <div class="nav-group left">
      <div class="nav-item mobile-button js-sidebar-toggle show-mobile">
        <span class="icon-menu"></span>
      </div>
      <div class="nav-item">
        
        <a class="logo-wrapper" href="https://www.apollographql.com/" title="Apollo ">
          <img src="../images/logo-apollo-space-left.svg" alt="Apollo" class="logo">
          
            <span></span>
          
        </a>
      </div>
    </div>


    
      <div class="nav-group right">
        <div id="nav-container" class="show-desktop"></div>
        <script src="https://apollographql-nav.netlify.com/index.js"></script>
        <script>ApolloNav.initNav({ theme: 'light' }, 'nav-container')</script>
      </div>
    
    </div>
  

  

<div class="sidebar charcoal">
  <div class="panel">
    
      <div id="sidebar-panel-nav"></div>
      <script>ApolloNav.initNav({ theme: 'light', id: 'mobile-nav' }, 'sidebar-panel-nav')</script>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo Server</span>
      
        <span class="select version-sidebar nochrome">
          <select class="version-select">
            
              <option value="v2">2</option>
            
              <option value="v1">1</option>
            
          </select>
        </span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-area">
        <div class="input-symbol small round">
          <input type="text" placeholder="Search Apollo Server" id="desktop-search-input">
          <span class="icon-search"></span>
        </div>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      

        <li>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../." class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../getting-started.html" class="sidebar-link ">
                  <span>Getting started</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../whats-new.html" class="sidebar-link ">
                  <span>What's new?</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Essentials</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../essentials/schema.html" class="sidebar-link ">
                  <span>Writing a schema</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../essentials/server.html" class="sidebar-link ">
                  <span>Building a server</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../essentials/data.html" class="sidebar-link ">
                  <span>Fetching data with resolvers</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Features</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../features/mocking.html" class="sidebar-link ">
                  <span>Mocking</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/errors.html" class="sidebar-link ">
                  <span>Error handling</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/data-sources.html" class="sidebar-link ">
                  <span>Data sources</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/subscriptions.html" class="sidebar-link ">
                  <span>Subscriptions</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/metrics.html" class="sidebar-link ">
                  <span>Monitoring and metrics</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/graphql-playground.html" class="sidebar-link ">
                  <span>GraphQL Playground</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/scalars-enums.html" class="sidebar-link ">
                  <span>Custom scalars and enums</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/unions-interfaces.html" class="sidebar-link ">
                  <span>Unions and interfaces</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/directives.html" class="sidebar-link ">
                  <span>Using schema directives</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/creating-directives.html" class="sidebar-link ">
                  <span>Implementing directives</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/authentication.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/testing.html" class="sidebar-link ">
                  <span>Integration testing</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Deployment</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../deployment/heroku.html" class="sidebar-link ">
                  <span>Heroku</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../deployment/lambda.html" class="sidebar-link ">
                  <span>Lambda</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../deployment/now.html" class="sidebar-link ">
                  <span>Now</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">API Reference</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../api/apollo-server.html" class="sidebar-link ">
                  <span>apollo-server</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../api/graphql-tools.html" class="sidebar-link ">
                  <span>graphql-tools</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Migration</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../migration-two-dot.html" class="sidebar-link ">
                  <span>Migrating to v2.0</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../migration-engine.html" class="sidebar-link ">
                  <span>Using Engine with v2.0</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../migration-file-uploads.html" class="sidebar-link ">
                  <span>File uploads in Node.js < v8.5.0</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      
    </ul>
  </div>
</div>

    <div class="content">

      <div class="header-content">
        <div class="header-wrapper">
          <div class="title-wrapper">
            <h1 class="title-page">
              Lambda
            </h1>
            
              <div class="subtitle-page">
                Setting up Apollo Server with AWS Lambda
              </div>
              
          </div>
        </div>
      </div>

      <div class="content-wrapper">
        <div class="document-formatting">
          <p><a href="https://badge.fury.io/js/apollo-server-lambda" target="_blank" rel="noopener"><img src="https://badge.fury.io/js/apollo-server-lambda.svg" alt="npm version"></a> <a href="https://circleci.com/gh/apollographql/apollo-server" target="_blank" rel="noopener"><img src="https://circleci.com/gh/apollographql/apollo-server.svg?style=svg" alt="Build Status"></a> <a href="https://spectrum.chat/apollo" target="_blank" rel="noopener"><img src="https://withspectrum.github.io/badge/badge.svg" alt="Join the community on Spectrum"></a></p>
<p>This is the AWS Lambda integration of GraphQL Server. Apollo Server is a community-maintained open-source GraphQL server that works with many Node.js HTTP server frameworks. <a href="https://www.apollographql.com/docs/apollo-server/v2">Read the docs</a>. <a href="https://github.com/apollographql/apollo-server/blob/master/CHANGELOG.md" target="_blank" rel="noopener">Read the CHANGELOG</a>.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-sh">npm install apollo-server-lambda graphql
</code></pre>
<h2 id="Deploying-with-AWS-Serverless-Application-Model-SAM"><a href="#Deploying-with-AWS-Serverless-Application-Model-SAM" class="headerlink" title="Deploying with AWS Serverless Application Model (SAM)"></a>Deploying with AWS Serverless Application Model (SAM)</h2><p>To deploy the AWS Lambda function we must create a Cloudformation Template and a S3 bucket to store the artifact (zip of source code) and template. We will use the <a href="https://aws.amazon.com/cli/" target="_blank" rel="noopener">AWS Command Line Interface</a>.</p>
<h4 id="1-Write-the-API-handlers"><a href="#1-Write-the-API-handlers" class="headerlink" title="1. Write the API handlers"></a>1. Write the API handlers</h4><p>In a file named <code>graphql.js</code>, place the following code:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">const { ApolloServer, gql } = require(&#39;apollo-server-lambda&#39;);

&#x2F;&#x2F; Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

&#x2F;&#x2F; Provide resolver functions for your schema fields
const resolvers = {
  Query: {
    hello: () =&gt; &#39;Hello world!&#39;,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

exports.handler = server.createHandler();
</code></pre>
<h4 id="2-Create-an-S3-bucket"><a href="#2-Create-an-S3-bucket" class="headerlink" title="2. Create an S3 bucket"></a>2. Create an S3 bucket</h4><p>The bucket name must be universally unique.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-bash">aws s3 mb s3:&#x2F;&#x2F;&lt;bucket name&gt;
</code></pre>
<h4 id="3-Create-the-Template"><a href="#3-Create-the-Template" class="headerlink" title="3. Create the Template"></a>3. Create the Template</h4><p>This will look for a file called graphql.js with the export <code>graphqlHandler</code>. It creates one API endpoints:</p>
<ul>
<li><code>/graphql</code> (GET and POST)</li>
</ul>
<p>In a file called <code>template.yaml</code>:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-yaml">AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Transform: AWS::Serverless-2016-10-31
Resources:
  GraphQL:
    Type: AWS::Serverless::Function
    Properties:
      Handler: graphql.handler
      Runtime: nodejs8.10
      Events:
        AnyRequest:
          Type: Api
          Properties:
            Path: &#x2F;graphql
            Method: ANY
</code></pre>
<h4 id="4-Package-source-code-and-dependencies"><a href="#4-Package-source-code-and-dependencies" class="headerlink" title="4. Package source code and dependencies"></a>4. Package source code and dependencies</h4><p>This will read and transform the template, created in previous step. Package and upload the artifact to the S3 bucket and generate another template for the deployment.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-sh">aws cloudformation package \
  --template-file template.yaml \
  --output-template-file serverless-output.yaml \
  --s3-bucket &lt;bucket-name&gt;
</code></pre>
<h4 id="5-Deploy-the-API"><a href="#5-Deploy-the-API" class="headerlink" title="5. Deploy the API"></a>5. Deploy the API</h4><p>This will create the Lambda Function and API Gateway for GraphQL. We use the stack-name <code>prod</code> to mean production but any stack name can be used.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-clike">aws cloudformation deploy \
  --template-file serverless-output.yaml \
  --stack-name prod \
  --capabilities CAPABILITY_IAM
</code></pre>
<h2 id="Getting-request-info"><a href="#Getting-request-info" class="headerlink" title="Getting request info"></a>Getting request info</h2><p>To read information about the current request from the API Gateway event (HTTP headers, HTTP method, body, path, …) or the current Lambda Context (Function Name, Function Version, awsRequestId, time remaining, …) use the options function. This way they can be passed to your schema resolvers using the context option.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">const { ApolloServer, gql } = require(&#39;apollo-server-lambda&#39;);

&#x2F;&#x2F; Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

&#x2F;&#x2F; Provide resolver functions for your schema fields
const resolvers = {
  Query: {
    hello: () =&gt; &#39;Hello world!&#39;,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: ({ event, context }) =&gt; ({
    headers: event.headers,
    functionName: context.functionName,
    event,
    context,
  }),
});

exports.handler = server.createHandler();
</code></pre>
<h2 id="Modifying-the-Lambda-Response-Enable-CORS"><a href="#Modifying-the-Lambda-Response-Enable-CORS" class="headerlink" title="Modifying the Lambda Response (Enable CORS)"></a>Modifying the Lambda Response (Enable CORS)</h2><p>To enable CORS the response HTTP headers need to be modified. To accomplish this use the <code>cors</code> option.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">const { ApolloServer, gql } = require(&#39;apollo-server-lambda&#39;);

&#x2F;&#x2F; Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

&#x2F;&#x2F; Provide resolver functions for your schema fields
const resolvers = {
  Query: {
    hello: () =&gt; &#39;Hello world!&#39;,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

exports.handler = server.createHandler({
  cors: {
    origin: &#39;*&#39;,
    credentials: true,
  },
});
</code></pre>
<p>To enable CORS response for requests with credentials (cookies, http authentication) the allow origin header must equal the request origin and the allow credential header must be set to true.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">const { ApolloServer, gql } = require(&#39;apollo-server-lambda&#39;);

&#x2F;&#x2F; Construct a schema, using GraphQL schema language
const typeDefs = gql`
  type Query {
    hello: String
  }
`;

&#x2F;&#x2F; Provide resolver functions for your schema fields
const resolvers = {
  Query: {
    hello: () =&gt; &#39;Hello world!&#39;,
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

exports.handler = server.createHandler({
  cors: {
    origin: true,
    credentials: true,
  },
});
</code></pre>
<h3 id="Cors-Options"><a href="#Cors-Options" class="headerlink" title="Cors Options"></a>Cors Options</h3><p>The options correspond to the <a href="https://github.com/expressjs/cors#configuration-options" target="_blank" rel="noopener">express cors configuration</a> with the following fields(all are optional):</p>
<ul>
<li><code>origin</code>: boolean | string | string[]</li>
<li><code>methods</code>: string | string[]</li>
<li><code>allowedHeaders</code>: string | string[]</li>
<li><code>exposedHeaders</code>: string | string[]</li>
<li><code>credentials</code>: boolean</li>
<li><code>maxAge</code>: number</li>
</ul>
<h2 id="Principles"><a href="#Principles" class="headerlink" title="Principles"></a>Principles</h2><p>GraphQL Server is built with the following principles in mind:</p>
<ul>
<li><strong>By the community, for the community</strong>: GraphQL Server’s development is driven by the needs of developers</li>
<li><strong>Simplicity</strong>: by keeping things simple, GraphQL Server is easier to use, easier to contribute to, and more secure</li>
<li><strong>Performance</strong>: GraphQL Server is well-tested and production-ready - no modifications needed</li>
</ul>
<p>Anyone is welcome to contribute to GraphQL Server, just read <a href="https://github.com/apollographql/apollo-server/blob/master/CONTRIBUTING.md" target="_blank" rel="noopener">CONTRIBUTING.md</a>, take a look at the <a href="https://github.com/apollographql/apollo-server/blob/master/ROADMAP.md" target="_blank" rel="noopener">roadmap</a> and make your first PR!</p>

        </div>
      </div>

      <div class="pagination">
        <div class="content-wrapper">
          
          
          
           
              <a class="link primary next" href="../index.html">
                <span class="subtitle-pagination">Next</span>
                Introduction
                  <span class="icon-arrow-right-alt"></span>
              </a>
           
          
        </div>
      </div>

      <div class="github">
        <a class="link tertiary " href="https://github.com/apollographql/apollo-server/tree/master/docs/source/servers/lambda.md" target="_blank">
          <span class="icon-github"></span>Edit on GitHub</a>
      </div>

      
    </div>

    
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/prism.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
        <script type="text/javascript" src="//cdn.jsdelivr.net/combine/npm/prismjs@1.15.0/components/prism-bash.min.js,npm/prismjs@1.15.0/components/prism-graphql.min.js,npm/prismjs@1.15.0/components/prism-json.min.js,npm/prismjs@1.15.0/components/prism-jsx.min.js,npm/prismjs@1.15.0/components/prism-less.min.js,npm/prismjs@1.15.0/components/prism-swift.min.js,npm/prismjs@1.15.0/components/prism-typescript.min.js,npm/prismjs@1.15.0/components/prism-yaml.min.js"></script>

    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/smooth-scroll@12.1.5/dist/js/smooth-scroll.min.js"></script>

    <script>
      // Used by the main.js script below.
      docsConfigRoot = '/docs/apollo-server/';
    </script>
    <script src="../script/main.js"></script>

    
      <script type="text/javascript" src="//cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();
    </script>

    

    
      <script>
        
        var analytics;

        <!-- Segment.io -->
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page();
        }}();
      </script>
    

    // search box
    
      <script>
        ['desktop'].forEach(function(type) {
          var search = docsearch({
            apiKey: '768e823959d35bbd51e4b2439be13fb7',
            
            
            indexName: 'apollodata',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            },
            algoliaOptions: {
              hitsPerPage: 20
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      </script>
    

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
    <script>
      window.addEventListener('load', function () {
        window.cookieconsent.initialise({
          palette: {
            popup: {
              background: '#555',
            },
            button: {
              text: '#333',
              background: '#CCC',
            },
          },
        })
      });
    </script>
  </body>
</html>
